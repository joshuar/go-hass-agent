name: go vulncheck

on: [push]

jobs:
  govulncheck_job:
    runs-on: ubuntu-latest
    name: Run govulncheck
    steps:
      - name: Install dependencies
        id: install_linux_deps
        run: sudo apt install -y desktop-file-utils gcc libgl1-mesa-dev libegl1-mesa-dev libgles2-mesa-dev libx11-dev xorg-dev

      - name: Update VERSION
        if: ${{ steps.release_please.outputs.release_created }}
        id: update_version
        shell: sh
        run: cd internal/agent && printf %s $(git tag | tail -1) > VERSION

      - name: Run govulncheck
        id: run_govulncheck
        uses: golang/govulncheck-action@v1
        with:
          go-version-input: "1.20.6"
          go-package: ./...
